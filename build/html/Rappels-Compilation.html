
<!DOCTYPE html>


<html lang="fr" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Rappel sur la compilation avec gcc &#8212; ASMx86_64</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/css/mystyle.css?v=ad4ecbd7" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=0dc8974b"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="_static/translations.js?v=e6b791cb"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Rappels-Compilation';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Les bases: les registres et l’adressage" href="x86_64-LesBases.html" />
    <link rel="prev" title="Rappels OS" href="Rappels-Syst%C3%A8me.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="fr"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">ASMx86_64</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Recherche</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contenu:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Rappels-Syst%C3%A8me.html">Rappels OS</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Rappel sur la compilation avec gcc</a></li>
<li class="toctree-l1"><a class="reference internal" href="x86_64-LesBases.html">Les bases: les registres et l’adressage</a></li>
<li class="toctree-l1"><a class="reference internal" href="x86_64-LesSyntaxes.html">Les syntaxes AT&amp;T et Intel</a></li>
<li class="toctree-l1"><a class="reference internal" href="x86_64-LesFonctions.html">Les fonctions et leur contexte en x86_64</a></li>

<li class="toctree-l1"><a class="reference internal" href="Tape3.html">Tape3</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Téléchargez cette page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Rappels-Compilation.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Télécharger le fichier source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimer au format PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Mode plein écran"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Rappel sur la compilation avec gcc</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenu </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#les-differentes-etapes-de-la-compilation">Les différentes étapes de la compilation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#etape-1-preprocessing-pretraitement">Étape 1 : Preprocessing (Prétraitement)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#etape-2-compilation">Étape 2 : Compilation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#etape-3-assembly-assemblage">Étape 3 : Assembly (Assemblage)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#etape-4-linkage-edition-des-liens">Étape 4 : Linkage (Édition des liens)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Étape 4 : Linkage (Édition des liens)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recuperer-l-assembleur-d-un-elf">Récupérer l’assembleur d’un ELF</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#objdump">objdump</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nm">nm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#readelf">readelf</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="rappel-sur-la-compilation-avec-gcc">
<h1>Rappel sur la compilation avec gcc<a class="headerlink" href="#rappel-sur-la-compilation-avec-gcc" title="Lien vers cette rubrique">#</a></h1>
<section id="les-differentes-etapes-de-la-compilation">
<h2>Les différentes étapes de la compilation<a class="headerlink" href="#les-differentes-etapes-de-la-compilation" title="Lien vers cette rubrique">#</a></h2>
<p>La compilation d’un programme C est un processus en plusieurs étapes, chacune transformant le code d’un format à un autre.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">.</span><span class="n">c</span><span class="p">]</span> <span class="o">---&gt;</span> <span class="p">[</span><span class="o">.</span><span class="n">i</span><span class="p">]</span> <span class="o">---&gt;</span> <span class="p">[</span><span class="o">.</span><span class="n">s</span><span class="p">]</span> <span class="o">---&gt;</span> <span class="p">[</span><span class="o">.</span><span class="n">o</span><span class="p">]</span> <span class="o">---+---&gt;</span> <span class="p">[</span><span class="n">ELF</span><span class="p">]</span>
                                          <span class="o">|</span>
                                 <span class="p">[</span><span class="o">.</span><span class="n">so</span><span class="p">]</span> <span class="o">--+</span>
</pre></div>
</div>
<section id="etape-1-preprocessing-pretraitement">
<h3>Étape 1 : Preprocessing (Prétraitement)<a class="headerlink" href="#etape-1-preprocessing-pretraitement" title="Lien vers cette rubrique">#</a></h3>
<p><strong>Commande</strong> : <code class="docutils literal notranslate"><span class="pre">gcc</span> <span class="pre">-E</span> <span class="pre">fichier.c</span> <span class="pre">-o</span> <span class="pre">fichier.i</span></code></p>
<p>Le préprocesseur effectue les opérations suivantes :</p>
<ul class="simple">
<li><p>Il supprime les commentaires du code source</p></li>
<li><p>Il développe les macros (#define)</p></li>
<li><p>Il inclut récursivement les fichiers d’en-tête (#include .h)</p></li>
<li><p>Il traite les directives conditionnelles (#ifdef, #ifndef, etc.)</p></li>
</ul>
<p>À la fin de cette étape, nous obtenons du code C pur et compilable. Le fichier contient également des « line markers » (méta-données) commençant par <code class="docutils literal notranslate"><span class="pre">#</span></code>, qui permettent de tracer l’origine du code (de quel include une ligne vient).</p>
<p><strong>Exemple</strong> :</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Avant preprocessing</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#define MAX 100</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Max: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MAX</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Après preprocessing (fichier .i)</span>
<span class="c1">// [Contenu de stdio.h et des includes imbriqués]</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Max: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="etape-2-compilation">
<h3>Étape 2 : Compilation<a class="headerlink" href="#etape-2-compilation" title="Lien vers cette rubrique">#</a></h3>
<p><strong>Commande</strong> : <code class="docutils literal notranslate"><span class="pre">gcc</span> <span class="pre">-S</span> <span class="pre">fichier.i</span> <span class="pre">-o</span> <span class="pre">fichier.s</span></code></p>
<p>Maintenant que nous avons tout le code C nécessaire au bon fonctionnement de notre programme, il faut le traduire en un langage plus compréhensible pour la machine. Cette étape se charge de :</p>
<ul class="simple">
<li><p>L’analyse syntaxique du code</p></li>
<li><p>La vérification des types</p></li>
<li><p>L’optimisation du code (-O1, -O2, -O3)</p></li>
<li><p>La génération du code assembleur pour l’architecture ciblée</p></li>
</ul>
<p>La majorité des optimisations s’effectue à cette étape. L’objectif est de bien traduire le langage de haut niveau (le C dans notre exemple) en code assembleur tout en tirant parti des optimisations offertes par l’architecture ciblée.</p>
<p>Le code assembleur se compose d’un mnémonique d’opération et d’opérandes. Il reste compréhensible par l’humain, mais moins que les langages de haut niveau comme le C ou Java.</p>
<div class="highlight-nasm notranslate"><div class="highlight"><pre><span></span><span class="c1">; &#39;movl&#39; est le mnémonique, &#39;$100&#39; et &#39;%esi&#39; sont les opérandes</span>
<span class="nf">movl</span><span class="w">    </span><span class="kc">$</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">esi</span>
</pre></div>
</div>
<p><strong>Options importantes</strong> :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-march=architecture</span></code> : Spécifie l’architecture cible</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-O[0-3]</span></code> : Niveau d’optimisation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-fverbose-asm</span></code> : Ajoute des commentaires dans l’assembleur</p></li>
</ul>
<p><strong>Exemple</strong> :</p>
<div class="highlight-nasm notranslate"><div class="highlight"><pre><span></span><span class="w">	</span><span class="nf">.file</span><span class="w">	</span><span class="s">&quot;exemple.c&quot;</span>
<span class="w">	</span><span class="nf">.text</span>
<span class="w">	</span><span class="nf">.section</span><span class="w">	</span><span class="nv">.rodata</span>
<span class="nl">.LC0:</span>
<span class="w">	</span><span class="nf">.string</span><span class="w">	</span><span class="s">&quot;Max: %d\n&quot;</span>
<span class="w">	</span><span class="nf">.text</span>
<span class="w">	</span><span class="nf">.globl</span><span class="w">	</span><span class="nv">main</span>
<span class="w">	</span><span class="nf">.type</span><span class="w">	</span><span class="nv">main</span><span class="p">,</span><span class="w"> </span><span class="err">@</span><span class="nv">function</span>
<span class="nl">main:</span>
<span class="nl">.LFB0:</span>
<span class="w">	</span><span class="nf">.cfi_startproc</span>
<span class="w">	</span><span class="nf">endbr64</span>
<span class="w">	</span><span class="nf">pushq</span><span class="w">	</span><span class="o">%</span><span class="nb">rbp</span>
<span class="w">	</span><span class="nf">.cfi_def_cfa_offset</span><span class="w"> </span><span class="mi">16</span>
<span class="w">	</span><span class="nf">.cfi_offset</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">16</span>
<span class="w">	</span><span class="nf">movq</span><span class="w">	</span><span class="o">%</span><span class="nb">rsp</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rbp</span>
<span class="w">	</span><span class="nf">.cfi_def_cfa_register</span><span class="w"> </span><span class="mi">6</span>
<span class="w">	</span><span class="nf">movl</span><span class="w">	</span><span class="kc">$</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">esi</span>
<span class="w">	</span><span class="nf">leaq</span><span class="w">	</span><span class="nv">.LC0</span><span class="p">(</span><span class="o">%</span><span class="nv">rip</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">	</span><span class="nf">movq</span><span class="w">	</span><span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="w">	</span><span class="nf">movl</span><span class="w">	</span><span class="kc">$</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">eax</span>
<span class="w">	</span><span class="nf">call</span><span class="w">	</span><span class="nv">printf@PLT</span>
<span class="w">	</span><span class="nf">movl</span><span class="w">	</span><span class="kc">$</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">eax</span>
<span class="w">	</span><span class="nf">popq</span><span class="w">	</span><span class="o">%</span><span class="nb">rbp</span>
<span class="w">	</span><span class="nf">.cfi_def_cfa</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">	</span><span class="nf">ret</span>
<span class="w">	</span><span class="nf">.cfi_endproc</span>
</pre></div>
</div>
</section>
<section id="etape-3-assembly-assemblage">
<h3>Étape 3 : Assembly (Assemblage)<a class="headerlink" href="#etape-3-assembly-assemblage" title="Lien vers cette rubrique">#</a></h3>
<p><strong>Commande</strong> :</p>
<ul class="simple">
<li><p>Via GCC : <code class="docutils literal notranslate"><span class="pre">gcc</span> <span class="pre">-c</span> <span class="pre">fichier.s</span> <span class="pre">-o</span> <span class="pre">fichier.o</span></code></p></li>
<li><p>Direct : <code class="docutils literal notranslate"><span class="pre">as</span> <span class="pre">fichier.s</span> <span class="pre">-o</span> <span class="pre">fichier.o</span></code></p></li>
</ul>
<p>Malheureusement, même le code assembleur n’est pas compréhensible par nos CPU qui ne fonctionnent qu’avec des 0 et des 1. L’assembleur <code class="docutils literal notranslate"><span class="pre">as</span></code> se charge de faire la dernière traduction en transformant les instructions en valeurs binaires. Cette représentation binaire est directement exécutable par le processeur, elle est compréhensibles par le décodeur du CPU, la partie qui dit aux autres composants quoi faire.</p>
<p>L’assembleur :</p>
<ul class="simple">
<li><p>Convertit le code assembleur en code machine</p></li>
<li><p>Crée une table des symboles</p></li>
<li><p>Génère des relocations si nécessaire</p></li>
<li><p>Produit un fichier objet au format ELF</p></li>
</ul>
</section>
<section id="etape-4-linkage-edition-des-liens">
<h3>Étape 4 : Linkage (Édition des liens)<a class="headerlink" href="#etape-4-linkage-edition-des-liens" title="Lien vers cette rubrique">#</a></h3>
<p><strong>Commande</strong> :</p>
<ul class="simple">
<li><p>Via GCC : <code class="docutils literal notranslate"><span class="pre">gcc</span> <span class="pre">fichier.o</span> <span class="pre">-o</span> <span class="pre">executable</span></code></p></li>
<li><p>Direct : <code class="docutils literal notranslate"><span class="pre">ld</span> <span class="pre">fichier.o</span> <span class="pre">-o</span> <span class="pre">executable</span></code></p></li>
</ul>
<p>On a tendance à bien structurer notre code et à le séparer en plusieurs fichiers pour mieux s’y retrouver lors de la relecture, que ce soit nous ou une autre personne. Il se peut même qu’on fasse appel à du code que nous n’avons pas écrit nous-mêmes, la libc étant le meilleur exemple (longue vie à printf !).</p>
<p>Notre exécutable doit inclure tous nos différents fichiers et aussi faire référence aux bibliothèques auxquelles on fait appel. Tout cela est géré par l’éditeur de liens <code class="docutils literal notranslate"><span class="pre">ld</span></code> qui :</p>
<ul class="simple">
<li><p>Résout les symboles externes</p></li>
<li><p>Combine les fichiers objets</p></li>
<li><p>Lie les bibliothèques dynamiques (libc, …) au fichier</p></li>
<li><p>Génère l’exécutable final</p></li>
</ul>
<p>Je vais réécrire la section sur le Linkage pour inclure ces informations importantes :</p>
</section>
<section id="id1">
<h3>Étape 4 : Linkage (Édition des liens)<a class="headerlink" href="#id1" title="Lien vers cette rubrique">#</a></h3>
<p><strong>Commande</strong> :</p>
<ul class="simple">
<li><p>Via GCC : <code class="docutils literal notranslate"><span class="pre">gcc</span> <span class="pre">fichier.o</span> <span class="pre">-o</span> <span class="pre">executable</span></code></p></li>
<li><p>Direct : <code class="docutils literal notranslate"><span class="pre">ld</span> <span class="pre">fichier.o</span> <span class="pre">-o</span> <span class="pre">executable</span></code></p></li>
</ul>
<p>On a tendance à bien structurer notre code et à le séparer en plusieurs fichiers pour mieux s’y retrouver lors de la relecture, que ce soit nous ou une autre personne. Il se peut même qu’on fasse appel à du code que nous n’avons pas écrit nous-mêmes, la libc étant le meilleur exemple (longue vie à printf !).</p>
<p>L’éditeur de liens <code class="docutils literal notranslate"><span class="pre">ld</span></code> (invoqué par <code class="docutils literal notranslate"><span class="pre">gcc</span></code>) a pour mission de rassembler tous ces morceaux de code. Il existe deux façons principales de lier ces différentes parties :</p>
<ol class="arabic simple">
<li><p><strong>La liaison statique</strong> :</p></li>
</ol>
<ul class="simple">
<li><p>Toutes les bibliothèques sont directement copiées dans l’exécutable final</p></li>
<li><p>Avantages : l’exécutable est autonome et portable</p></li>
<li><p>Inconvénients : taille plus importante de l’exécutable, pas de mise à jour automatique des bibliothèques</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p><strong>La liaison dynamique</strong> (avec les .so) :</p></li>
</ol>
<ul class="simple">
<li><p>Seules les références aux bibliothèques sont incluses dans l’exécutable</p></li>
<li><p>Les bibliothèques partagées (.so - Shared Objects sous Linux) sont chargées au moment de l’exécution (les pages mémoire sont partagées par tous les processus l’utilisant)</p></li>
<li><p>Avantages :</p>
<ul>
<li><p>Économie d’espace disque (les .so sont partagées entre les programmes)</p></li>
<li><p>Mise à jour des bibliothèques sans recompiler les programmes</p></li>
<li><p>Chargement à la demande des bibliothèques</p></li>
</ul>
</li>
<li><p>Inconvénients :</p>
<ul>
<li><p>Dépendance aux bibliothèques installées sur le système</p></li>
<li><p>Potentielles incompatibilités lors des mises à jour</p></li>
</ul>
</li>
</ul>
<p>L’éditeur de liens effectue donc plusieurs tâches cruciales :</p>
<ul class="simple">
<li><p>Résout les symboles externes (trouve où se trouvent les fonctions et variables utilisées)</p></li>
<li><p>Combine les fichiers objets (.o)</p></li>
<li><p>Gère les liaisons avec les bibliothèques (statiques .a ou dynamiques .so)</p></li>
<li><p>Vérifie que toutes les dépendances sont satisfaites</p></li>
<li><p>Génère l’exécutable final au format ELF</p></li>
</ul>
<p><strong>Exemple pratique</strong> :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Création d&#39;une bibliothèque partagée</span>
gcc<span class="w"> </span>-shared<span class="w"> </span>-fPIC<span class="w"> </span>ma_lib.c<span class="w"> </span>-o<span class="w"> </span>libma_lib.so

<span class="c1"># Compilation avec liaison dynamique (par défaut)</span>
gcc<span class="w"> </span>mon_prog.c<span class="w"> </span>-L.<span class="w"> </span>-lma_lib<span class="w"> </span>-o<span class="w"> </span>prog

<span class="c1"># Compilation avec liaison statique</span>
gcc<span class="w"> </span>mon_prog.c<span class="w"> </span>-static<span class="w"> </span>-L.<span class="w"> </span>-lma_lib<span class="w"> </span>-o<span class="w"> </span>prog_static
</pre></div>
</div>
<p>Cette étape finale du processus de compilation est cruciale car elle détermine non seulement comment notre programme va s’exécuter, mais aussi comment il va interagir avec le reste du système.</p>
<blockquote class="small-text">
Références :
<ul>
<li><a href="https://stackoverflow.com/questions/77108297/breaking-down-the-c-compilation-process-into-preprocessing-compilation-assembl">https://stackoverflow.com/questions/77108297/breaking-down-the-c-compilation-process-into-preprocessing-compilation-assembl</a></li>
</ul>
</blockquote>
</section>
</section>
<section id="recuperer-l-assembleur-d-un-elf">
<h2>Récupérer l’assembleur d’un ELF<a class="headerlink" href="#recuperer-l-assembleur-d-un-elf" title="Lien vers cette rubrique">#</a></h2>
<section id="objdump">
<h3>objdump<a class="headerlink" href="#objdump" title="Lien vers cette rubrique">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">objdump</span></code> est un outil puissant de la suite binutils qui permet d’analyser et de désassembler des fichiers objets et des exécutables.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Exemple d’utilisation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-d</span></code></p></td>
<td><p>Désassemble les sections contenant des instructions</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">objdump</span> <span class="pre">-d</span> <span class="pre">executable</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-D</span></code></p></td>
<td><p>Désassemble toutes les sections (y compris .data) sauf le .bss</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">objdump</span> <span class="pre">-D</span> <span class="pre">executable</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-S</span></code></p></td>
<td><p>Mélange code source si disponible et assembleur</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">objdump</span> <span class="pre">-S</span> <span class="pre">executable</span></code></p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-j</span> <span class="pre">section</span></code></p></td>
<td><p>Affiche uniquement la section spécifiée</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">objdump</span> <span class="pre">-d</span> <span class="pre">-j</span> <span class="pre">.text</span> <span class="pre">executable</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--section=sec</span></code></p></td>
<td><p>Identique à -j</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">objdump</span> <span class="pre">--section=.plt</span> <span class="pre">executable</span></code></p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-M</span> <span class="pre">intel</span></code></p></td>
<td><p>Utilise la syntaxe Intel</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">objdump</span> <span class="pre">-M</span> <span class="pre">intel</span> <span class="pre">-d</span> <span class="pre">executable</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-M</span> <span class="pre">att</span></code></p></td>
<td><p>Utilise la syntaxe AT&amp;T (par défaut)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">objdump</span> <span class="pre">-M</span> <span class="pre">att</span> <span class="pre">-d</span> <span class="pre">executable</span></code></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="nm">
<h3>nm<a class="headerlink" href="#nm" title="Lien vers cette rubrique">#</a></h3>
<p>Affiche les symboles d’un fichier objet :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nm<span class="w"> </span>fichier.o
</pre></div>
</div>
</section>
<section id="readelf">
<h3>readelf<a class="headerlink" href="#readelf" title="Lien vers cette rubrique">#</a></h3>
<p>Analyse détaillée des fichiers ELF :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># En-tête ELF</span>
readelf<span class="w"> </span>-h<span class="w"> </span>executable

<span class="c1"># Table des sections</span>
readelf<span class="w"> </span>-S<span class="w"> </span>executable

<span class="c1"># Segments (Program Headers)</span>
readelf<span class="w"> </span>-l<span class="w"> </span>executable
</pre></div>
</div>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Rappels-Syst%C3%A8me.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">précédent</p>
        <p class="prev-next-title">Rappels OS</p>
      </div>
    </a>
    <a class="right-next"
       href="x86_64-LesBases.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">suivant</p>
        <p class="prev-next-title">Les bases: les registres et l’adressage</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenu
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#les-differentes-etapes-de-la-compilation">Les différentes étapes de la compilation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#etape-1-preprocessing-pretraitement">Étape 1 : Preprocessing (Prétraitement)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#etape-2-compilation">Étape 2 : Compilation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#etape-3-assembly-assemblage">Étape 3 : Assembly (Assemblage)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#etape-4-linkage-edition-des-liens">Étape 4 : Linkage (Édition des liens)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Étape 4 : Linkage (Édition des liens)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recuperer-l-assembleur-d-un-elf">Récupérer l’assembleur d’un ELF</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#objdump">objdump</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nm">nm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#readelf">readelf</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Par Mazigh
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Mazigh.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>